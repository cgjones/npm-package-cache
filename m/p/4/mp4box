{"_id":"mp4box","_rev":"2-eadeeea97dd6487ec7be7b44974d5608","name":"mp4box","description":"JavaScript version of GPAC's MP4Box tool","dist-tags":{"latest":"0.3.8"},"versions":{"0.1.0":{"name":"mp4box","version":"0.1.0","description":"JavaScript version of GPAC's MP4Box tool","keywords":["mp4","HTML 5 media","Media Source Extension","streaming"],"homepage":"https://github.com/gpac/mp4box.js","main":"dist/mp4box.all.js","repository":{"type":"git","url":"git://github.com/gpac/mp4box.js.git"},"bugs":{"url":"https://github.com/gpac/mp4box.js/issues"},"author":{"name":"Cyril Concolato","email":"cyril.concolato@telecom-paristech.fr","url":"http://concolato.wp.mines-telecom.fr/"},"licenses":[{"type":"BSD-3-Clause","url":"https://github.com/gpac/mp4box.js/blob/master/LICENSE"}],"devDependencies":{"grunt-contrib-concat":"^0.5.0","grunt-contrib-connect":"^0.8.0","grunt-contrib-jshint":"^0.10.0","grunt-contrib-qunit":"^0.5.2","grunt-contrib-uglify":"^0.6.0","grunt-contrib-watch":"^0.6.1","qunitjs":"^1.15.0"},"scripts":{"test":"grunt --verbose"},"gitHead":"3c78b18e6387e93b5850ceff5b30601b17afebdb","_id":"mp4box@0.1.0","_shasum":"882222d1dd9c78aa11caa5b28e20fcad8de24dea","_from":".","_npmVersion":"2.7.4","_nodeVersion":"0.12.2","_npmUser":{"name":"cconcolato","email":"cyril.concolato@telecom-paristech.fr"},"dist":{"shasum":"882222d1dd9c78aa11caa5b28e20fcad8de24dea","tarball":"http://registry.npmjs.org/mp4box/-/mp4box-0.1.0.tgz"},"maintainers":[{"name":"cconcolato","email":"cyril.concolato@telecom-paristech.fr"}],"directories":{}},"0.3.8":{"name":"mp4box","version":"0.3.8","description":"JavaScript version of GPAC's MP4Box tool","keywords":["mp4","HTML 5 media","Media Source Extension","streaming"],"homepage":"https://github.com/gpac/mp4box.js","main":"dist/mp4box.all.js","repository":{"type":"git","url":"git://github.com/gpac/mp4box.js.git"},"bugs":{"url":"https://github.com/gpac/mp4box.js/issues"},"author":{"name":"Cyril Concolato","email":"cyril.concolato@telecom-paristech.fr","url":"http://concolato.wp.mines-telecom.fr/"},"licenses":[{"type":"BSD-3-Clause","url":"https://github.com/gpac/mp4box.js/blob/master/LICENSE"}],"devDependencies":{"grunt-bump":"^0.3.1","grunt-contrib-concat":"^0.5.0","grunt-contrib-connect":"^0.8.0","grunt-contrib-jshint":"^0.10.0","grunt-contrib-qunit":"^0.5.2","grunt-contrib-uglify":"^0.6.0","grunt-contrib-watch":"^0.6.1","grunt-karma":"^0.11.0","karma":"^0.12.35","karma-chrome-launcher":"^0.1.12","karma-firefox-launcher":"^0.1.6","karma-qunit":"^0.1.4","qunitjs":"^1.15.0"},"scripts":{"test":"grunt --verbose"},"gitHead":"366e04c72cf65dbf886e62902388ccd96f9654c0","_id":"mp4box@0.3.8","_shasum":"a1427caa3c8812dc5f762198aa64b1e078181069","_from":".","_npmVersion":"2.7.4","_nodeVersion":"0.12.2","_npmUser":{"name":"cconcolato","email":"cyril.concolato@telecom-paristech.fr"},"dist":{"shasum":"a1427caa3c8812dc5f762198aa64b1e078181069","tarball":"http://registry.npmjs.org/mp4box/-/mp4box-0.3.8.tgz"},"maintainers":[{"name":"cconcolato","email":"cyril.concolato@telecom-paristech.fr"}],"directories":{}}},"readme":"MP4Box.js\r\n======\r\n\r\n[![Build Status](https://travis-ci.org/gpac/mp4box.js.svg?branch=master)](https://travis-ci.org/gpac/mp4box.js)\r\n\r\nJavaScript library to process MP4 files in the browser (and in NodeJS), with support for progressive parsing. \r\nInspired by the [MP4Box](http://gpac.wp.mines-telecom.fr/mp4box/) tool from the [GPAC](http://gpac.wp.mines-telecom.fr) project. \r\nIt can be used to:\r\n- [get information about an MP4 file](#getting-information), \r\n- [segment](#segmentation) an MP4 file for use with the [Media Source Extension API](https://dvcs.w3.org/hg/html-media/raw-file/tip/media-source/media-source.html),\r\n- [extract](#extraction) samples from an MP4 to create TextTracks.\r\n- more to come.\r\n\r\nA Player demo is available [here](http://download.tsi.telecom-paristech.fr/gpac/mp4box.js/), a File Analyzer is available [here](http://download.tsi.telecom-paristech.fr/gpac/mp4box.js/filereader.html), and some QUnit tests are [here](http://download.tsi.telecom-paristech.fr/gpac/mp4box.js/qunit.html)\r\n\r\nAPI\r\n===\r\n\r\n###Getting Information###\r\nSimilar to `MP4Box -info file.mp4`, MP4Box.js can provide general information about the file (duration, number and types of tracks ...). For that, create an MP4Box object, set the `onReady` callback and provide data in the form of ArrayBuffer objects. MP4Box.js supports progressive parsing. You can provide small buffers at a time, the callback will be called when the 'moov' box is parsed.\r\n\r\n```javascript\r\nvar MP4Box = require('mp4box').MP4Box; // Or whatever import method you prefer.\r\nvar mp4box = new MP4Box();\r\nmp4box.onError = function(e) {};\r\nmp4box.onReady = function(info) {};\r\nmp4box.appendBuffer(data);\r\nmp4box.appendBuffer(data);\r\nmp4box.appendBuffer(data);\r\n...\r\nmp4box.flush();\r\n```\r\n\r\n####onMoovStart()####\r\nThe `onMoovStart` callback is called when the 'moov' box is starting to be parsed. Depending on the download speed, it may take a while to download the whole 'moov' box. The end of parsing is signaled by the `onReady` callback.\r\n\r\n```javascript\r\nmp4box.onMoovStart = function () {\r\n\tconsole.log(\"Starting to receive File Information\");\r\n}\r\n```\r\n\r\n####onReady(info)####\r\nThe `onReady` callback is called when the the 'moov' box has been parsed, i.e. when the metadata about the file is parsed. \r\n\r\n```javascript\r\nmp4box.onReady = function (info) {\r\n\tconsole.log(\"Received File Information\");\r\n}\r\n```\r\n\r\nThe `info` argument is an object with the following structure.\r\n```json\r\n{\r\n  \"duration\":360002,\r\n  \"timescale\":600,\r\n  \"isFragmented\":false,\r\n  \"isProgressive\":true,\r\n  \"hasIOD\":true,\r\n  \"brands\":[\"isom\"],\r\n  \"created\":\"2014-04-15T18:24:40.000Z\",\r\n  \"modified\":\"2014-04-15T18:24:40.000Z\",\r\n  \"tracks\":[\r\n    {\r\n\t  \"id\":2,\r\n\t  \"created\":\"2012-02-13T23:07:31.000Z\",\r\n\t  \"modified\":\"2014-04-16T12:22:56.000Z\",\r\n\t  \"movie_duration\":360000,\r\n\t  \"layer\":0,\r\n\t  \"alternate_group\":0,\r\n\t  \"volume\":0,\r\n\t  \"track_width\":320,\r\n\t  \"track_height\":180,\r\n\t  \"timescale\":25000,\r\n\t  \"duration\":15000000,\r\n\t  \"bitrate\":120000,\r\n\t  \"codec\":\"avc1.42c00d\",\r\n\t  \"video\":{\r\n\t    \"width\":320,\"height\":180\r\n\t  },\r\n\t  \"language\":\"und\",\r\n\t  \"nb_samples\":15000\r\n\t},\r\n\t{\r\n\t  \"id\":3,\r\n\t  \"created\":\"2012-09-12T11:14:57.000Z\",\r\n\t  \"modified\":\"2014-04-16T12:22:56.000Z\",\r\n\t  \"movie_duration\":360002,\r\n\t  \"layer\":0,\r\n\t  \"alternate_group\":0,\r\n\t  \"volume\":1,\r\n\t  \"track_width\":0,\r\n\t  \"track_height\":0,\r\n\t  \"timescale\":44100,\r\n\t  \"duration\":26460160,\r\n\t  \"bitrate\":60000,\r\n\t  \"codec\":\"mp4a.40.2\",\r\n\t  \"audio\":{\r\n\t    \"sample_rate\":44100,\r\n\t\t\"channel_count\":1,\r\n\t\t\"sample_size\":16\r\n\t  },\r\n\t  \"language\":\"und\",\r\n\t  \"nb_samples\":25840\r\n\t}\r\n  ]\r\n}\r\n```\r\n- **brands**: Array of 4CC codes corresponding to the file brands,\r\n- **created**: Date object, indicating the creation date of the file as given in the file header,\r\n- **modified**: Date object, indicating the last modification date of the file as given in the file header,\r\n- **timescale**: Number, corresponding to the timescale as given in the file header,\r\n- **duration**: Number, providing the duration of the movie (unfragmented part) in timescale units,\r\n- **isProgressive**: boolean, indicating if the file can be played progressively,\r\n- **isFragmented**: boolean, indicating if the file is already fragmented,\r\n- **fragment_duration**: Number, giving the duration of the fragmented part of the file, in timescale units,\r\n- **hasIOD**: boolean, indicating if the the file contains an MPEG-4 Initial Object Descriptor\r\n- **tracks**: Array of track information objects\r\n\r\nTrack information object:\r\n- **id**: Number, giving track identifier,\r\n- **created**: Date object, indicating the creation date of the file as given in the track header,\r\n- **modified**: Date object, indicating the last modification date of the file as given in the track header,\r\n- **alternate_group**: Number, identifier of the alternate group the track belongs to,\r\n- **timescale**: Number, indicating the track timescale, as given in the track header,\r\n- **duration**: Number, providing the duration of the (unfragmented part of) track, in timescale units,\r\n- **bitrate**: Number, providing the bitrate of the track in bits per second,\r\n- **nb_samples**: Number, giving the number of track samples (ie. frames),\r\n- **codec**: String, giving the MIME codecs parameter for this track (e.g. \"avc1.42c00d\" or \"mp4a.40.2\"), to be used to create SourceBuffer objects with [Media Source Extensions](https://dvcs.w3.org/hg/html-media/raw-file/tip/media-source/media-source.html),\r\n- **language**: String, giving the 3-letter language code,\r\n- **track_width**: Number, width of the track as indicated in the track header,\r\n- **track_height**: Number, height of the track as indicated in the track header,\r\n- **layer**: Number, layer information as indicated in the track header,\r\n- **video**: Object, information specific for video tracks\r\n- **audio**: Object, information specific for audio tracks\r\n\r\nVideo-specific information object:\r\n- **width**: Number, width of the video track as indicated in the media header,\r\n- **height**: Number, height of the video track as indicated in the media header,\r\n\r\nAudio-specific information object:\r\n- **sample_rate**: Number, sample rate as indicated in the media header,\r\n- **channel_count**: Number, number of channels as indicated in the media header,\r\n- **sample_size**: Number, size in bits of an uncompressed audio sample as indicated in the media header,\r\n\r\n####onError(e)####\r\nIndicates that an error has occured during the processing. `e` is a String.\r\n```javascript\r\nmp4box.onError = function (e) {\r\n\tconsole.log(\"Received Error Message \"+e);\r\n}\r\n```\r\n\r\n####appendBuffer(data)####\r\nProvides an ArrayBuffer to parse from. The ArrayBuffer must have a `fileStart` (Number) property indicating the 0-based position of first byte of the ArrayBuffer in the original file. Returns the offset (in the original file) that is expected to be the `fileStart` value of the next buffer. \r\n```javascript\r\nvar ab = getArrayBuffer();\r\nab.fileStart = 0;\r\nmp4box.appendBuffer(ab);\r\n```\r\n\r\n####start()####\r\nIndicates that sample processing can start (segmentation or extraction). Sample data already received will be processed and new buffer append operation will trigger sample processing as well.\r\n\r\n####stop()####\r\nIndicates that sample processing is stopped. Buffer append operations will not trigger calls to onSamples or onSegment.\r\n\r\n####flush()####\r\nIndicates that no more data will be received and that all remaining samples should be flushed in the segmentation or extraction process.\r\n\r\n###Segmentation###\r\n\r\n```javascript\r\nvar mp4box = new MP4Box();\r\nmp4box.onReady = function(info) {\r\n  ...\r\n  mp4box.onSegment = function (id, user, buffer) {}\r\n  mp4box.setSegmentOptions(info.tracks[0].id, sb, options);  \r\n  var initSegs = mp4box.initializeSegmentation();  \r\n  mp4box.start();\r\n  ...\r\n};\r\n```\r\n\r\n####setSegmentOptions(track_id, user, options)####\r\nIndicates that the track with the given `track_id` should be segmented, with the given options. When segments are ready, the callback [onSegment](#onsegmentid_user_buffer) is called with the `user` parameter. The `options` argument is an object with the following properties:\r\n- **nbSamples**: Number, representing the number of frames per segment, i.e. the time between 2 callbacks to onSegment. If not enough data is received to form a segment, received samples are kept. If not provided, the default is 1000.\r\n- **rapAlignement**: boolean, indicating if segments should start with a RAP. If not provided, the default is true.\r\n\r\n```javascript\r\nmp4box.setSegmentOptions(1, sb, { nbSamples: 1000 });\r\n```\r\n \r\n####unsetSegmentOptions(track_id)####\r\nIndicates that the track with the given `track_id` should not be segmented.\r\n```javascript\r\nmp4box.unsetSegmentOptions(1);\r\n```\r\n\r\n####onSegment(id, user, buffer)####\r\nCallback called when a segment is ready, according to the options passed in [setSegmentOptions](##setsegmentoptionstrack_id-user-options). `user` is the caller of the segmentation, for this track, and `buffer` is an ArrayBuffer containing the Movie Fragments for this segment.\r\n\r\n```javascript\r\nmp4box.onSegment = function (id, user, buffer) {\r\n\tconsole.log(\"Received segment on track \"+id+\" for object \"+user+\" with a length of \"+buffer.byteLength);\r\n}\r\n```\r\n\r\n####initializeSegmentation()####\r\nIndicates that the application is ready to receive segments. Returns an array of objects containing the following properties:\r\n- **id**: Number, the track id \r\n- **user**: Object, the caller of the segmentation for this track, as given in [setSegmentOptions](##setsegmentoptionstrack_id-user-options)\r\n- **buffer**: ArrayBuffer, the initialization segment for this track.\r\n\r\n```json\r\n[\r\n  {\r\n\t\"id\":2,\r\n\t\"buffer\":\"[ArrayBuffer]\",\r\n\t\"user\":\"[SourceBuffer]\"\r\n  },\r\n  {\r\n\t\"id\":3,\r\n\t\"buffer\":\"[ArrayBuffer]\",\r\n\t\"user\":\"[SourceBuffer]\"\r\n  }\r\n]\r\n```\r\n\r\n###Extraction###\r\nIt is possible to extract the samples of a track, in a similar manner to the segmentation process.\r\n```javascript\r\nvar mp4box = new MP4Box();\r\nmp4box.onReady = function(info) {\r\n  ...\r\n  /* create a texttrack */\r\n  var texttrack = v.addTextTrack(\"metadata\", \"Text track for extraction of track \"+info.tracks[0].id);\r\n  mp4box.onSamples = function (id, user, samples) {}\r\n  mp4box.setExtractionsOptions(info.tracks[0].id, texttrack, options);  \r\n  mp4box.start();\r\n  ...\r\n};\r\n```\r\n\r\n####setExtractionOptions(track_id, user, options)####\r\nIndicates that the track with the given `track_id` for which samples should be extracted, with the given options. When samples are ready, the callback [onSamples](#onsamplesid-user-samples) is called with the `user` parameter. The `options` argument is an object with the following properties:\r\n- **nbSamples**: Number, representing the number of samples per callback callt. If not enough data is received to extract the number of samples, the samples received so far are kept. If not provided, the default is 1000.\r\n- **rapAlignement**: boolean, indicating if sample arrays should start with a RAP. If not provided, the default is true.\r\n\r\n```javascript\r\nmp4box.setExtractionOptions(1, texttrack, { nbSamples: 1000 });\r\n```\r\n \r\n####unsetExtractionOptions(track_id)####\r\nIndicates that the samples for the track with the given `track_id` should not be extracted.\r\n```javascript\r\nmp4box.unsetExtractionOptions(1);\r\n```\r\n\r\n####onSamples(id, user, samples)####\r\nCallback called when a set of samples is ready, according to the options passed in [setExtractionOptions](#setextractionoptionstrack_id-user-options). `user` is the caller of the segmentation, for this track, and `samples` is an Array of samples.\r\n\r\n```javascript\r\nmp4box.onSamples = function (id, user, samples) {\r\n\tconsole.log(\"Received \"+samples.length+\" samples on track \"+id+\" for object \"+user);\r\n}\r\n```\r\n\r\nEach sample has the following structure:\r\n```json\r\n{\r\n\t\"track_id\":4,\r\n\t\"description\": \"[Box]\",\r\n\t\"is_rap\":true,\r\n\t\"timescale\":1000,\r\n\t\"dts\":0,\r\n\t\"cts\":0,\r\n\t\"duration\":1000,\r\n\t\"size\":41,\r\n\t\"data\": \"[ArrayBuffer]\"\r\n}\r\n```\r\n\r\n####seek(time, useRap)####\r\nIndicates that the next samples to process (for extraction or segmentation) start at the given time (Number, in seconds) or at the time of the previous Random Access Point (if useRap is true, default is false). Returns the offset in the file of the next bytes to be provided via [appendBuffer](#appendbufferdata) .\r\n```javascript\r\nmp4box.seek(10, true);\r\n```\r\n####releaseUsedSamples(id, sampleNumber)####\r\nReleases the memory allocated for sample data for the given track id, up to (but excluding) the given sample number.\r\n```\r\nmp4box.releaseUsedSamples(1, 250);\r\n```\r\n\r\nBuild\r\n=======\r\n`MP4Box.js` implements many features (parsing of many types of boxes, writing of boxes, sample processing, on-the-fly fragmentation ...). All these features may not be needed in all applications. In order to allow for a flexible configuration of the features, and to reduce the size of the final library, `MP4Box.js` is split in many files and uses the [Grunt](http://gruntjs.com/) system to compile a set of selected features into a single file. Currently, `MP4Box.js` comes in two flavors:\r\n  - all: includes all the features\r\n  - simple: allows for parsing of boxes only (no writing, no sample processing) and only of some boxes (not all). You can configure which box you want by adding the file in the [Gruntfile.js](Gruntfile.js) `concat:simple` task.\r\n\r\nGrunt builds the versions of the single-file library in the  ```dist``` folder, minified (```mp4box.all.min.js```,```mp4box.simple.min.js```) or not (```mp4box.all.js```,```mp4box.simple.js```).\r\n\r\nDependencies\r\n=======\r\nIn this ```all``` version, this code uses [DataStream.js](https://github.com/kig/DataStream.js), with some modifications for Uint24 and Uint64 types. In the ```simple``` version, there are no external dependencies.\r\n\r\nBrowser Usage\r\n=======\r\nIn order to use the `MP4Box.js` in a browser, use grunt to build a single-file library (see above) or use a pre-built version from the [demo](http://download.tsi.telecom-paristech.fr/gpac/mp4box.js/) page.\r\n\r\n```html\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <title>MP4Box.js in the browser</title>\r\n  <script src=\"mp4box.all.min.js\"></script>\r\n</head>\r\n<body>\r\n...\r\n</body>\r\n</html>\r\n```\r\n\r\nNode Usage\r\n=======\r\nMP4Box.js can be used in Node.js. See for example the [info.js](test/node/info.js) example.\r\n\r\nContributing\r\n=======\r\nIf your favorite box is not parsed by MP4Box, you can easily contribute. Each box parsing code is stored in a separate file whose name is the 4CC of the box type. For instance, the parsing of the ```ctts``` box is located in [ctts.js](src/parsing/ctts.js).\r\n","maintainers":[{"name":"cconcolato","email":"cyril.concolato@telecom-paristech.fr"}],"time":{"modified":"2015-07-20T14:50:00.545Z","created":"2015-04-11T07:44:04.355Z","0.1.0":"2015-04-11T07:44:04.355Z","0.3.8":"2015-07-20T14:50:00.545Z"},"homepage":"https://github.com/gpac/mp4box.js","keywords":["mp4","HTML 5 media","Media Source Extension","streaming"],"repository":{"type":"git","url":"git://github.com/gpac/mp4box.js.git"},"author":{"name":"Cyril Concolato","email":"cyril.concolato@telecom-paristech.fr","url":"http://concolato.wp.mines-telecom.fr/"},"bugs":{"url":"https://github.com/gpac/mp4box.js/issues"},"readmeFilename":"README.md","_attachments":{}}